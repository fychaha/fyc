# 分表分库

## 垂直拆分

垂直拆分就是要把表按模块划分到不同**数据库**表中（当然原则还是不破坏第三范式），这种拆分在大型网站的演变过程中是很常见的。当一个网站还在很小的时候，只有小量的人来开发和维护，各模块和表都在一起，当网站不断丰富和壮大的时候，也会变成多个子系统来支撑，这时就有按模块和功能把表划分出来的需求。其实，相对于垂直切分更进一步的是服务化改造，说得简单就是要把原来强耦合的系统拆分成多个弱耦合的服务，通过服务间的调用来满足业务需求看，因此表拆出来后要通过服务的形式暴露出去，而不是直接调用不同模块的表，淘宝在架构不断演变过程，最重要的一环就是服务化改造，把用户、交易、店铺、宝贝这些核心的概念抽取成独立的服务，也非常有利于进行局部的优化和治理，保障核心模块的稳定性

垂直拆分用于分布式场景。

## 水平拆分

上面谈到垂直切分只是把表按模块划分到不同数据库，但没有解决单表大数据量的问题，而水平切分就是要把一个表按照某种规则把数据划分到不同表或数据库里。例如像计费系统，通过按时间来划分表就比较合适，因为系统都是处理某一时间段的数据。而像SaaS应用，通过按用户维度来划分数据比较合适，因为用户与用户之间的隔离的，一般不存在处理多个用户数据的情况，简单的按user_id范围来水平切分

通俗理解：水平拆分行，行数据拆分到不同表中， 垂直拆分列，表数据拆分到不同表中

# 分表

### 取模拆分(哈希取模) 数据均匀分配：

将以下表均匀拆分（表user）

| id   | name     | pwd  |
| ---- | -------- | ---- |
| 1    | zhangsan | 123  |
| 2    | lisi     | 123  |
| 3    | wangwu   | 123  |
| 4    | zhaoliu  | 123  |



id|

通常有一张表专门存放id。

根据分多少张表来决定。例如分三张表：(user0,user1,user2)

1. 首先获取userid

2. 判断存放到不同的表   userid % 3 = x ,就放到userx表里。

   如id为1的， 1%3=1，所以将其存入表user1里。

这种方法通常用在内部rpc调用分表规则。在通过userid查询到的时候能很快，但是用其他字段来查询时效率可能不会很高。

# 分库

多主，的时候考虑到主键唯一重复插入，可以设置主数据库1插入奇数，主数据库2插入偶数。

