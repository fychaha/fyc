# zookeeper 介绍

ZooKeeper 是一个开放源代码的分布式协调服务，是一个典型的分布式数据一致性解决方案。

Ø 由知名互联网公司雅虎创建

Ø 是Google Chubby的开源实现

Ø 后来成为Apacahe Hadoop的子项目，是一个树型的目录服务

Ø 2010年11月正式成为Apache的顶级项目。

Ø 使用java开发

Ø zookeeper=文件系统+通知机制

# 作用

Ø 命名服务- 按名称标识集群中的节点。它类似于DNS，但仅对于节点。

Ø 配置服务-按名称标识集群中的节点。它类似于DNS，但仅对于节点。

Ø 集群管理 - 实时地在集群和节点状态中加入/离开节点。

Ø 选举算法 - 选举一个节点作为协调目的的leader。

Ø 分布式锁

Ø 分布式事务





## zookeeper命令

创建：create

列出结点：ls

读取结点信息：get

更新结点信息：set 

删除结点：delete

# 基本概念

7.1. ZNode节点

ZNode被分为持久（persistent）节点，顺序（sequential）节点和临时（ephemeral）节点。

持久节点：即使在创建该特定znode的客户端断开连接后，持久节点仍然存在。默认情况下，除非另有说明，否则所有znode都是持久的。

顺序节点：顺序节点可以是持久的或临时的。当一个新的znode被创建为一个顺序节点时，ZooKeeper通过将10位的序列号附加到原始名称来设置znode的路径。例如，如果将具有路径 /test 的znode创建为顺序节点，则ZooKeeper会将路径更改为 /test0000000001 ，并将下一个序列号设置为0000000002。如果两个顺序节点是同时创建的，那么ZooKeeper不会对每个znode使用相同的数字。顺序节点在锁定和同步中起重要作用。

 

临时节点：客户端活跃时，临时节点就是有效的。当客户端与ZooKeeper集合断开连接时，临时节点会自动删除。因此，只有临时节点不允许有子节点。如果临时节点被删除，则下一个合适的节点将填充其位置。临时节点在leader选举中起着重要作用。

7.2. Session回话

会话对于ZooKeeper的操作非常重要。会话中的请求按FIFO顺序执行。一旦客户端连接到服务器，将建立会话并向客户端分配会话ID 。

客户端以特定的时间间隔发送心跳以保持会话有效。如果ZooKeeper集合在超过服务器开启时指定的期间（会话超时）都没有从客户端接收到心跳，则它会判定客户端死机。

会话超时通常以毫秒为单位。当会话由于任何原因结束时，在该会话期间创建的临时节点也会被删除。

7.3.Watcher监视

监视是一种简单的机制，使客户端收到关于ZooKeeper集合中的更改的通知。客户端可以在读取特定znode时设置Watches。Watches会向注册的客户端发送任何znode（客户端注册表）更改的通知。

Znode更改是与znode相关的数据的修改或znode的子项中的更改。只触发一次watches。如果客户端想要再次通知，则必须通过另一个读取操作来完成。当连接会话过期时，客户端将与服务器断开连接，相关的watches也将被删除。