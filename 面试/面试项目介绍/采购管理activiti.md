##### 采购管理项目流程

整个采购模块流程是这样的。前台采购申请人发起采购请求，申请人与申请时间字段采购插入申请表，申请表主键回填，作为本次业务id（bussinessKey），调用runtimeService接口方法，开启我们的流程。

接下来执行流程的第一步，采购申请人（前端）传入本次申请要购买的货物，货物集合我是以map的方式存储的，键为商品id，值为这个商品的数量。后台对这个map做遍历，对采购申请详情表逐条插入，该表与采购申请表关联，拥有商品id与商品数量字段，同时把审核人id插入activiti任务实例表内的任务接受人。之后对向前台返回申请成功的信息。

接下来流程第二步，进入第一次审核，审核人接受任务，前台使用ajax请求查询采购申请表与采购申请详情表，将完整的采购申请单展示在页面上，审核人可以按需选择驳回或者批准，这时向采购申请表插入剩余的三个字段，审批人id和本次审批时间以及审批结果，最后完成本次任务，通过本次任务的bussinessKey更新activiti任务实例表。

接下来流程的第三步，采购并生成采购单与采购方案详情单，前台传入采购人id，和一个map，这个map键为采购人id，值为一个存放申请详情对象的列表（List<PurApplication>）。先对采购单做插入，遍历map的键，拿出供应商id，将供应商，审核开始时间插入采购订单表。然后主键回填，拿到采购单id，然后遍历list，拿到list里的采购申请表对象，从对象中获取商品id和申请详情表id作为条件查询申请详情表list。接下来再次对查出来的申请详情表遍历出申请详情id，和商品数量等字段全部插入采购方案详情表。最终给返回申请成功的信息。

流程的最后一步，进入最后的审核，前台依旧发送ajax请求，返回给前台方案详情表的数据，审核人按需选择审核是否通过，然后向后台传入审核结果和审核时间，后台最终把订单表剩余的审核结果和审核时间两个字段插入。

以上就是整个业务流程。



